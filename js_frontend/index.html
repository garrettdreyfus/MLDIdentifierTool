<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
<script type="text/javascript" src="profiles.json"></script>

<body>
	<div style="width:33%; height:50%;float:left;">
		<canvas id="temperatureChart" width="0.1" height="0.1"></canvas>
	</div>
	<div style="width:33%; height:50%;float:left;">
		<canvas id="salinityChart" width="0.1" height="0.1"></canvas>
	</div>
	<div style="width:33%; height:50%;float:left;">
		<canvas id="densityChart" width="0.1" height="0.1"></canvas>
	</div>
	<div id="answers" style="width:50%; height:30%;float:bottom-left;">
	</div>
</body>

<script>
var profiles = JSON.parse(data);
var profileNumber =-1;
var answers = [];
var salinities = [];
var temperatures = [];
var densities= [];
Chart.defaults.LineWithLine = Chart.defaults.line;
	Chart.controllers.LineWithLine = Chart.controllers.line.extend({
		 draw: function(ease) {
				Chart.controllers.line.prototype.draw.call(this, ease);
				if (this.chart.tooltip._active && this.chart.tooltip._active.length) {
					 var activePoint = this.chart.tooltip._active[0],
							 ctx = this.chart.ctx,
							 y = activePoint.tooltipPosition().y,
							 leftX = this.chart.scales['x-axis-0'].left,
							 rightX = this.chart.scales['x-axis-0'].right;

					 // draw line
					 ctx.save();
					 ctx.beginPath();
					 ctx.moveTo(leftX,y);
					 ctx.lineTo(rightX,y);
					 ctx.lineWidth = 2;
					 ctx.strokeStyle = '#07C';
					 ctx.stroke();
					 ctx.restore();
				}
		 }
	});

	var ctx = document.getElementById("temperatureChart").getContext('2d');

	tx = new Chart(ctx, {
			type: 'LineWithLine',
			data: {
					datasets: [{
							label: 'Temperatures',
							fill:false,
							borderColor: "blue",
							data: temperatures
					}]
			},
			options: {
					fill:false,
					scales: {
							xAxes: [{
									type: 'linear',
									position: 'bottom'
							}],
							yAxes: [{
									ticks: {
										min: -200,
										max:0
									}
							}]

					}
			}
	});
	var ctx = document.getElementById("salinityChart").getContext('2d');
	sx = new Chart(ctx, {
			type: 'LineWithLine',
			data: {
					datasets: [{
							label: 'Salinities',
							fill:false,
							borderColor: "blue",
							data: salinities
					}]
			},
			options: {
					fill:false,
					scales: {
							xAxes: [{
									type: 'linear',
									position: 'bottom'
							}],
							yAxes: [{
									ticks: {
										min: -200,
										max:0
									}
							}]

					}
			}
	});
	var ctx = document.getElementById("densityChart").getContext('2d');
	dx = new Chart(ctx, {
			type: 'LineWithLine',
			data: {
					datasets: [{
							label: 'Densities',
							fill:false,
							borderColor: "blue",
							data: densities,
					}],
			},
			options: {
					scales: {
							xAxes: [{
									type: 'linear',
									position: 'bottom'
							}],
							yAxes: [{
									ticks: {
										min: -200,
										max:0
									}
							}]

					}
			}
	});




function updateGraph() {
	profileNumber++;	
	profile = profiles[profileNumber];
	var salinities = [];
	var temperatures = [];
	var densities= [];


	for(i=0;i<profile["pressures"].length;i++){
		temperatures.push({"x":profile["temperatures"][i],"y":-profile["pressures"][i]})	
	}
	for(i=0;i<profile["pressures"].length;i++){
		salinities.push({"x":profile["salinities"][i],"y":-profile["pressures"][i]})	
	}
	for(i=0;i<profile["pressures"].length;i++){
		densities.push({"x":profile["densities"][i],"y":-profile["pressures"][i]})	
	}
	tx.data.datasets[0].data = temperatures;
	tx.update();
	sx.data.datasets[0].data = salinities;
	sx.update();
	dx.data.datasets[0].data = densities;
	dx.update();
}
updateGraph()
document.getElementById("temperatureChart").onclick = function (evt) {
	var points = tx.getElementsAtEvent(evt);
	console.log(tx);
	answers.push({"depth":profile["pressures"][points[0]._index],"id":profile.name});
	updateGraph();
	var out = "[";
	for(var i=0;i<answers.length;i++){
		
		out+=JSON.stringify(answers[i]);
		out+=","
	}
	out+="]";
	document.getElementById("answers").innerHTML=out;
};
document.getElementById("salinityChart").onclick = function (evt) {
	var points = sx.getElementsAtEvent(evt);
	console.log(sx);
	answers.push({"depth":profile["pressures"][points[0]._index],"id":profile.name});
	updateGraph();
	var out = "[";
	for(var i=0;i<answers.length;i++){
		
		out+=JSON.stringify(answers[i]);
		out+=","
	}
	out+="]";
	document.getElementById("answers").innerHTML=out;
};
document.getElementById("densityChart").onclick = function (evt) {
	var points = dx.getElementsAtEvent(evt);
	console.log(dx);
	answers.push({"depth":profile["pressures"][points[0]._index],"id":profile.name});
	updateGraph();
	var out = "[";
	for(var i=0;i<answers.length;i++){
		
		out+=JSON.stringify(answers[i]);
		out+=","
	}
	out+="]";
	document.getElementById("answers").innerHTML=out;
};
</script>

